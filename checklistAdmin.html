<apex:page docType="html-5.0"
sidebar="false" 
showheader="false"
standardStylesheets="false"
Controller="ChecklistAdminController"
applyHtmlTag="false"
applyBodyTag="false"   
id="todo"
>
<html ng-app="checklistApp">        
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1,  minimum-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="viewport" content="initial-scale = 1.0, user-scalable = no"/>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.js"> </script>
</head>    

<body>
    <div ng-controller="AdminCtrl">
        <form name="newChecklistForm">
          <h1>Checklist Name</h1>
          <input type="text" ng-model="checklist.name" name="formName" ng-required="true"></input>
          <h1>Checklist Description</h1>
          <input type="text" ng-model="checklist.description"></input>
          <div ng-repeat="item in items">
            <h1> Question {{$index + 1}}</h1>
            <input type="text" ng-model="item.Question__c" name="Q1" ng-required="true"></input>
            <input type="number" ng-model="item.Order__c" name="O2" ng-required="true"></input>
            <input type="checkbox" ng-model="item.Required__c" name="O3"></input>
            <select ng-model="item.Type__c" ng-options="type for type in types" ng-required="true"></select>
            {{item.Question__c}}
        </div>
        <input type="button" value="+" ng-click="addQuestion()"></input>
        <input type="button" value="-" ng-click="removeQuestion()"></input>

        <input type="submit" value="Submit " ng-click="newChecklist()"> </input>

    </form>
    <div id="checklistList" >
     <form name="EditChecklistForm">
        <li ng-repeat=""> 
            <p> Name: </p> <input type="text" ng-model="item.Name" ng-required="true"></input>
            <p> Description: {{itemi5.Description__c}} </p>
            <p> Id: {{itemi5.Id}} </p>
            <input type="submit" value="Submit" ng-click="editChecklist()"></input>
        </li>
    </form>
        <div ng-repeat="question in questions">
          <input type="text" ng-model="question.Question__c" ng-required="true"></input>
          {{question.Order__c}}
          {{question.isActive__c}}
      </div>
</div>
</div>

</body>

<script>
/* Angular */
var checklistApp = angular.module('checklistApp', []);
var checklistitems;

checklistApp.controller("AdminCtrl", function ($scope) {
    $scope.numQuestions = 1;
    $scope.items = new Array();
    $scope.items[0] = new Object();
    $scope.items[0].Required__c = true;
    $scope.checklist = new Object();
    $scope.checklist = new Object();
    $scope.checklist.name = 'Default Name';
    $scope.checklist.description = 'Default Description';
    $scope.checklists = {!CheckLists};
    $scope.item = $scope.checklists[3];
    $scope.types = ['Yes/No', 'Number', 'Text', 'Date','Long Text', 'Rating', 'Picklist', 'Multi-Select'];
    $scope.newChecklist = function() {
     if ($scope.newChecklistForm.$valid) {
        $scope.createChecklist();
    } else {
        console.log('invalid');
    }
}
$scope.createChecklist = function() {
    for(var i = 0; i < $scope.items.length; i++) {
        delete $scope.items[i].$$hashKey;
        console.log($scope.items[i].Type__c);
    }
    Visualforce.remoting.Manager.invokeAction(
        '{!$RemoteAction.ChecklistAdminController.createChecklistWithQuestions}',
        $scope.checklist.name,
        $scope.checklist.description,
        $scope.items,
        function(result, event) {
            if (event.status) {
                console.log('Created everything');
            } else if (event.type == 'exception') {
                console.log('Exception');
            } else {
                console.log('Error!');
            }
        },
        {escape: true}
        );
};
$scope.addQuestion = function() {
    $scope.items.push(new Object());
}
$scope.removeQuestion = function() {
    $scope.items.pop();
}
$scope.editChecklist = function() {
    delete $scope.item.attributes;
    Visualforce.remoting.Manager.invokeAction(
        '{!$RemoteAction.ChecklistAdminController.updateChecklist}',
        $scope.item,
        function(result, event) {
            if (event.status) {
                console.log('Updated everything');
            } else if (event.type == 'exeception') {
                console.log('Exception');
            } else {
                console.log('Error!');
            }
        },
        {escape: true}
        );
};
$scope.getChecklistItems = function() {
    delete $scope.item.attributes;
    Visualforce.remoting.Manager.invokeAction(
        '{!$RemoteAction.ChecklistAdminController.getChecklistItems}',
        $scope.item,
        function(result, event) {
            if(event.status) {
                $scope.questions = result;
                $scope.$apply();
            } else if (event.type == 'exception') {
                console.log('Exception');
            } else {
                console.log('Error!');
            }
        },
        {escape:true}
        );
};
$scope.getChecklistItems();
});

</script>

</html>
</apex:page>